<IfModule mod_ssl.c>
SSLStaplingCache shmcb:/var/run/apache2/stapling_cache(128000)
<VirtualHost *:443>
  ServerName kolab.{{ mailserver_domain }}
  ServerAlias autodiscover.{{ mailserver_domain }} {{ custom_domains | join(' kolab.') }} {{ custom_domains | join(' autodiscover.') }}

DocumentRoot /usr/share/roundcubemail/public_html/

ErrorLog /var/log/httpd/kolab_error.log
CustomLog /var/log/httpd/kolab_access.log combined

<LocationMatch "/assets/">
    <IfModule mod_deflate.c>
        SetEnv no-gzip
    </IfModule>
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
    </IfModule>
</LocationMatch>

<Directory "/usr/share/roundcubemail/public_html">
    Options +FollowSymLinks
    AllowOverride None

    <ifModule mod_rewrite.c>
        RewriteEngine On
        RewriteCond %{REQUEST_URI}  ^/
        RewriteRule ^[a-zA-Z0-9]{16}/(.*) /%1/$1 [PT,L]
    </ifModule>
    <ifModule mod_authz_core.c>
        Require all granted
    </ifModule>
    <ifModule !mod_authz_core.c>
        Order Allow,Deny
        Allow from All
    </ifModule>
</Directory>

SSLCertificateFile /etc/letsencrypt/certificates/{{ mailserver_domain }}.pem
SSLCertificateKeyFile /etc/letsencrypt/certificates/{{ mailserver_domain }}.key
Include /etc/letsencrypt/options-ssl-apache.conf
Header always set Strict-Transport-Security "max-age=31536000"
SSLUseStapling on
</VirtualHost>
</IfModule>
