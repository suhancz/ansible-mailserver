[general]
accounts = oldimap

[Account oldimap]
localrepository = newimap
remoterepository = oldimap

[Repository newimap]
type = IMAP
remotehost = {{ mailserver_domain }}
remoteuser = {{ current_user.name }}@{{ mailserver_domain }}
remotepass = {{ current_user.password }}
sslcacertfile = /etc/ssl/certs/ca-bundle.trust.crt
nametrans = lambda folder: folder if folder in re.search('(.*\.Junk$|.*\.Sent$|.*\.Spam$|.*\.Trash$)', folder) else 'INBOX.' + folder
folderfilter = lambda folder: not re.search('(^Trash$|Del)', folder)

[Repository oldimap]
type = IMAP
remotehost = {{ item.old_imap_mail.host }}
remoteuser = {{ item.old_imap_mail.user }}
remotepass = {{ item.old_imap_mail.password }}
{% if (not item.old_imap_mail.ssl_verify) and (old_imap_fingerprint is defined and 'Fingerprint=' in old_imap_fingerprint) %}
cert_fingerprint = {{ old_imap_fingerprint.stdout | trim | split('Fingerprint=') | last }}

{% else %}
sslcacertfile = /etc/ssl/certs/ca-bundle.trust.crt

{% endif %}
