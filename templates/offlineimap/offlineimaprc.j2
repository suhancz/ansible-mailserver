[general]
accounts = oldimap

[Account oldimap]
localrepository = newimap
remoterepository = oldimap

[Repository newimap]
type = IMAP
remotehost = {{ mailserver_domain }}
remoteuser = {{ current_user.name }}@{{ mailserver_domain }}
remotepass = {{ current_user.password }}
sslcacertfile = /etc/ssl/certs/ca-bundle.trust.crt

[Repository oldimap]
type = IMAP
remotehost = {{ current_user.old_imap_mail.host }}
remoteuser = {{ current_user.old_imap_mail.user }}
remotepass = {{ current_user.old_imap_mail.password }}
# The below will put all folders as sub-folders of the 'local' INBOX,
# assuming that your path separator on 'local' is a dot.
nametrans = lambda x: 'INBOX.' + x
{% if (not current_user.old_imap_mail.ssl_verify) and (old_imap_fingerprint is defined and ((old_imap_fingerprint.stdout | regex_search('Fingerprint=')) | length > 0)) %}
cert_fingerprint = {{ old_imap_fingerprint.stdout | regex_search('Fingerprint\=.*') | split('Fingerprint=') | last }}

{% else %}
sslcacertfile = /etc/ssl/certs/ca-bundle.trust.crt

{% endif %}
